defaultTasks 'build'

task virtualenv(type:Exec) {
    commandLine 'virtualenv', '-p', 'python3', '.'
}

task installdependencies(type:Exec) {
    commandLine 'bin/pip', 'install', 'flake8', 'requests', 'pyyaml', 'python-dateutil', 'pytest', 'setuptools'
}

task test(type:Exec) {
    commandLine 'bin/pytest', 'tests'
}

task lint(type:Exec) {
    commandLine 'bin/flake8', 'blink', 'tests'
}

task build(type:Exec) {
    commandLine 'bin/python', 'setup.py', 'sdist', 'bdist_wheel'
}

task publish(type:Exec) {
    commandLine 'twine', 'upload', 'dist/*'
}

installdependencies.dependsOn virtualenv
lint.dependsOn installdependencies
test.dependsOn lint
build.dependsOn test
publish.dependsOn build
